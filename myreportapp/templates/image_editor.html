<!-- myreportapp/image_editor.html -->


{% extends 'base.html' %}

{% block center_content %}
    <h1>Editor de Imagens</h1>
    <div>
        <canvas id="display-image" width="800" height="600"></canvas>
    </div>
    <button id="select_image">Nova Imagem</button>
    <button id="another_button">Outra Ação</button>
{% endblock center_content %}

{% block scripts %}
<script>
    const canvas = document.querySelector('#display-image');
    const ctx = canvas.getContext('2d');

    // RENDERIZA IMAGEM SELECIONADA NO CANVAS
    function selectAndRenderImage() {
        selectImage()
        .then((file) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    adjustSize(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        })
        .catch((error) => {
            alert(error);
        });
    }

    // SELECIONA UMA IMAGEM NO EXPLORADOR DE ARQUIVOS
    function selectImage() {
        return new Promise((resolve, reject) => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*'; 
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    resolve(file);
                } else {
                    reject('Nenhuma imagem selecionada.');
                }
            });
            input.click();
        });
    }

    // AJUSTA O TAMANHO DA IMAGEM
    function adjustSize(img) {
        const maxWidth = canvas.width; 
        const aspectRatio = img.height / img.width; 
        canvas.width = maxWidth; 
        canvas.height = maxWidth * aspectRatio; 
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }

    // Adicionando eventos aos botões
    document.querySelector('#select_image').addEventListener('click', selectAndRenderImage);
    document.querySelector('#another_button').addEventListener('click', selectAndRenderImage);
</script>
{% endblock scripts %}
