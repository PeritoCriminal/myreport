<!-- myreportapp/image_editor.html -->


{% extends 'base.html' %}

{% block center_content %}
    <h1>Editor de Imagens</h1>
    <div>
        <canvas id="display-image" width="800" height="600"></canvas>
    </div>
    <button id="select_image">Nova Imagem</button>
    <button id="one_button">Uma Ação</button>
    <button id="another_button">Outra Ação</button>
{% endblock center_content %}

{% block scripts %}
<script>
    const canvas = document.querySelector('#display-image');
    const ctx = canvas.getContext('2d');

    // RENDERIZA IMAGEM SELECIONADA NO CANVAS
    function selectAndRenderImage() {
        selectImage()
        .then((file) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    adjustSize(img);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        })
        .catch((error) => {
            alert(error);
        });
    }

    // SELECIONA UMA IMAGEM NO EXPLORADOR DE ARQUIVOS
    function selectImage() {
        return new Promise((resolve, reject) => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*'; 
            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    resolve(file);
                } else {
                    reject('Nenhuma imagem selecionada.');
                }
            });
            input.click();
        });
    }

    // AJUSTA O TAMANHO DA IMAGEM
    function adjustSize(img) {
        const maxWidth = canvas.width; 
        const aspectRatio = img.height / img.width; 
        canvas.width = maxWidth; 
        canvas.height = maxWidth * aspectRatio; 
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }

    // ROTACIONA A IMAGEM NO SENTIDO HORÁRIO
    function rotate_clockwise() {
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');        
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;        
        tempCtx.drawImage(canvas, 0, 0);        
        const newWidth = canvas.height;
        const newHeight = canvas.width;
        canvas.width = newWidth;
        canvas.height = newHeight;        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(Math.PI / 2); 
        ctx.drawImage(tempCanvas, -tempCanvas.width / 2, -tempCanvas.height / 2); 
        ctx.restore();
    }
    
    // ROTACIONA A IMAGEM NO SENTIDO ANTI-HORÁRIO
    function rotate_counterclockwise() {
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');        
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;        
        tempCtx.drawImage(canvas, 0, 0);        
        const newWidth = canvas.height;
        const newHeight = canvas.width;
        canvas.width = newWidth;
        canvas.height = newHeight;        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.drawImage(tempCanvas, -tempCanvas.height / 2, -tempCanvas.width / 2); 
        ctx.restore();
    }
    

    // Adicionando eventos aos botões
    document.querySelector('#select_image').addEventListener('click', selectAndRenderImage);
    document.querySelector('#one_button').addEventListener('click', rotate_clockwise);
    document.querySelector('#another_button').addEventListener('click', rotate_counterclockwise);
</script>
{% endblock scripts %}
