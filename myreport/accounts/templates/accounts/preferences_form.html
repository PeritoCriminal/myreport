{# myreport/accounts/templates/accounts/preferences_form.html #}

{% extends "base.html" %}

{% block title %}Preferências{% endblock %}

{% block page_header %}
  {% include 'headerbars/profile_header.html' with owner=profile_user %}
{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 640px;">
  <h2 class="mb-4">Preferências</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} mb-3" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" novalidate>
    {% csrf_token %}

    {# garante retorno à página de origem após salvar #}
    {% if next %}
      <input type="hidden" name="next" value="{{ next }}">
    {% endif %}

    {{ form.non_field_errors }}

    <div class="mb-3">
      <label class="form-label" for="{{ form.theme.id_for_label }}">{{ form.theme.label }}</label>
      {{ form.theme }}
      {{ form.theme.errors }}
    </div>

    <div class="mb-3">
      <label class="form-label" for="{{ form.default_home.id_for_label }}">{{ form.default_home.label }}</label>
      {{ form.default_home }}
      {{ form.default_home.errors }}
    </div>

    {% comment %}
       Lotação / Unidade
    {% endcomment %}

    {% if form.nucleus %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.nucleus.id_for_label }}">{{ form.nucleus.label }}</label>
        {{ form.nucleus }}
        {% if form.nucleus.help_text %}
          <div class="form-text">{{ form.nucleus.help_text }}</div>
        {% endif %}
        {{ form.nucleus.errors }}
      </div>
    {% endif %}

    {% if form.team %}
      <div class="mb-3">
        <label class="form-label" for="{{ form.team.id_for_label }}">{{ form.team.label }}</label>
        {{ form.team }}
        {% if form.team.help_text %}
          <div class="form-text">{{ form.team.help_text }}</div>
        {% else %}
          <div class="form-text">Deixe em branco para remover a equipe.</div>
        {% endif %}
        {{ form.team.errors }}
      </div>
    {% endif %}

    <div class="mb-3">
      <label class="form-label" for="{{ form.closing_phrase.id_for_label }}">{{ form.closing_phrase.label }}</label>
      {{ form.closing_phrase }}
      {% if form.closing_phrase.help_text %}
        <div class="form-text">{{ form.closing_phrase.help_text }}</div>
      {% endif %}
      {{ form.closing_phrase.errors }}
    </div>

    <div class="d-flex gap-2">
      <button class="btn btn-primary" type="submit">Salvar</button>

      {# botão voltar respeitando a origem, com fallback #}
      {% if next %}
        <a class="btn btn-outline-secondary" href="{{ next }}">Voltar</a>
      {% else %}
        <a class="btn btn-outline-secondary" href="{% url 'home:dashboard' %}">Voltar</a>
      {% endif %}
    </div>
  </form>
</div>
{% endblock %}
