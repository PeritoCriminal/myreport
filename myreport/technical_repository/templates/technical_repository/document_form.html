{% extends "base.html" %}
{% load static %}


{% block title %}
  {% if is_update %}Editar documento técnico{% else %}Novo documento técnico{% endif %}
{% endblock %}

{% block page_header %}
  {% include 'accounts/partials/profile_header.html' %}
{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 820px;">

  <form method="post" enctype="multipart/form-data" novalidate>
    {% csrf_token %}

    <!-- ================= Documento ================= -->
    <div class="card mb-4">
      <div class="card-header fw-semibold">
        Dados do documento
      </div>
      <div class="card-body">

        {# Se estiver editando e já existir PDF, exibe um link do arquivo atual #}
        {% if is_update and document and document.pdf_file %}
          <div class="mb-3">
            <div class="small text-muted mb-1">PDF atual</div>
            <a
              href="{{ document.pdf_file.url }}"
              class="btn btn-sm btn-outline-danger d-inline-flex align-items-center"
              target="_blank"
            >
              <i class="bi bi-file-earmark-pdf me-2"></i>
              Abrir / baixar PDF
            </a>
          </div>
        {% endif %}

        {% for field in form %}
          <div class="mb-3">
            <label class="form-label">{{ field.label }}</label>

            {# Dica específica para o campo de arquivo, quando em edição #}
            {% if is_update and field.name == "pdf_file" %}
              <div class="form-text mb-1">
                Se quiser substituir o PDF, selecione um novo arquivo. Se deixar em branco, o PDF atual será mantido.
              </div>
            {% endif %}

            {{ field }}

            {% if field.help_text %}
              <div class="form-text">{{ field.help_text }}</div>
            {% endif %}

            {% for error in field.errors %}
              <div class="invalid-feedback d-block">
                {{ error }}
              </div>
            {% endfor %}
          </div>
        {% endfor %}

      </div>
    </div>

    <!-- ================= Ações ================= -->
    <div class="d-flex justify-content-end gap-2">
      <a href="{% url 'technical_repository:document_list' %}"
         class="btn btn-outline-secondary">
        Cancelar
      </a>

      <button type="submit" class="btn btn-primary">
        {% if is_update %}Salvar alterações{% else %}Salvar documento{% endif %}
      </button>
    </div>

  </form>
</div>
{% endblock %}
