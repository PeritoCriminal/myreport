{# myreport/report_maker/templates/report_maker/partials/text_block_editor.html #}

{% comment %}
  Partial genérico para edição de blocos de texto em Markdown.

  Espera no contexto:
  - field_name   (obrigatório) → name/id do textarea
  - label        (opcional)    → rótulo exibido
  - value        (opcional)    → conteúdo inicial
  - help_text    (opcional)    → texto de ajuda
  - rows         (opcional)    → default 6
  - placeholder  (opcional)
  - required     (opcional)    → True/False

  (NOVO — opcional)
  - enable_ai    (opcional)    → True/False
  - ai_kind      (opcional)    → Prioridade 1: Tipo específico (ex: "HISTORIC")
                                 Prioridade 2: Se omitido, usa o field_name
                                 Prioridade 3: Default "generic"
  - ai_url       (opcional)    → url do endpoint
{% endcomment %}

<div class="mb-3 text-block-editor" data-text-block-editor>
  <div class="d-flex justify-content-between align-items-center gap-2 mb-2">
    <div class="flex-grow-1">
      {% include "report_maker/partials/markdown_toolbar.html" %}
    </div>

    {% if enable_ai %}
      <button type="button"
              class="btn btn-sm btn-outline-primary"
              data-ai-generate
              data-ai-kind="{{ ai_kind|default:field_name|default:'generic' }}"
              data-ai-target="{{ field_name }}"
              data-report-id="{{ report_id }}"
              data-ai-url="{% if ai_url %}{{ ai_url }}{% else %}{% url 'report_maker:ai_textblock_generate' %}{% endif %}">
        <i class="bi bi-robot"></i> Gerar (IA)
      </button>
    {% endif %}
  </div>

  {% if label %}
    <label for="{{ field_name }}" class="form-label fw-semibold">
      {{ label }}
    </label>
  {% endif %}

  <textarea
    name="{{ field_name }}"
    id="{{ field_name }}"
    class="form-control font-monospace"
    rows="{{ rows|default:6 }}"
    {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
    {% if required %}required{% endif %}
  >{{ value|default_if_none:"" }}</textarea>

  {% if help_text %}
    <div class="form-text">{{ help_text }}</div>
  {% else %}
    <div class="form-text">
      Suporta <strong>Markdown</strong> (parágrafos, listas, negrito, itálico).
    </div>
  {% endif %}
</div>