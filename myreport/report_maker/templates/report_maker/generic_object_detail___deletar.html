{% extends 'base.html' %}
{% load static %}

{% block title %}
  {{ obj.title }}
{% endblock %}

{% block content %}
  <div class="container mt-4" style="max-width: 900px;">

    {# Título apenas informativo, sem botões #}
    <div class="mb-4">
      <h4 class="mb-0">{{ obj.title }}</h4>
    </div>

    {% if obj.description %}
      <section class="mb-3">
        <h6>Descrição</h6>
        <p class="mb-0">{{ obj.description|linebreaks }}</p>
      </section>
    {% endif %}

    {% if obj.methodology %}
      <section class="mb-3">
        <h6>Metodologia</h6>
        <p class="mb-0">{{ obj.methodology|linebreaks }}</p>
      </section>
    {% endif %}

    {% if obj.examination %}
      <section class="mb-3">
        <h6>Exame</h6>
        <p class="mb-0">{{ obj.examination|linebreaks }}</p>
      </section>
    {% endif %}

    {% if obj.results %}
      <section class="mb-3">
        <h6>Resultados</h6>
        <p class="mb-0">{{ obj.results|linebreaks }}</p>
      </section>
    {% endif %}

    {# ──────────────  Imagens vinculadas ao objeto ─────────────── #}
    <section class="mt-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0">Imagens</h6>

        {% if obj.report_case.can_edit %}
          <a
            class="btn btn-sm btn-primary"
            href="{% url 'report_maker:image_add' obj_app_label obj_model_name obj.pk %}"
          >
            <i class="bi bi-plus-lg"></i> Adicionar imagem
          </a>
        {% endif %}
      </div>

      {% if obj.images.exists %}
        <div class="row g-2">
          {% for img in obj.images.all %}
            <div class="col-6 col-md-4">
              <div class="card h-100">
                <img
                  src="{{ img.image.url }}"
                  class="card-img-top"
                  alt="{{ img.caption|default:'Imagem' }}"
                />
                <div class="card-body py-2">

                  {% if img.caption %}
                    <div class="small text-muted">{{ img.caption }}</div>
                  {% endif %}

                  {% if obj.report_case.can_edit %}
                    <div class="mt-2 d-flex gap-2">
                      <a
                        class="btn btn-outline-primary btn-sm"
                        href="{% url 'report_maker:image_update' img.pk %}"
                      >
                        Editar
                      </a>
                      <a
                        class="btn btn-outline-danger btn-sm"
                        href="{% url 'report_maker:image_delete' img.pk %}"
                      >
                        Excluir
                      </a>
                    </div>
                  {% endif %}

                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted small mt-2 mb-0">Nenhuma imagem cadastrada.</p>
      {% endif %}
    </section>

    {# ──────  Barra única de ações no rodapé  ────────────── #}
    <div class="mt-5 d-flex justify-content-between align-items-center">

      <a
        href="{% url 'report_maker:report_detail' obj.report_case.pk %}"
        class="btn btn-outline-secondary btn-sm"
      >
        Voltar ao laudo
      </a>

      {% if obj.report_case.can_edit %}
        <div class="btn-group">
          <a
            href="{% url 'report_maker:generic_object_update' obj.pk %}"
            class="btn btn-outline-primary btn-sm"
          >
            Editar Objeto
          </a>
          <a
            href="{% url 'report_maker:generic_object_delete' obj.pk %}"
            class="btn btn-outline-danger btn-sm"
          >
            Excluir Objeto
          </a>
        </div>
      {% endif %}

    </div>

  </div>
{% endblock %}
