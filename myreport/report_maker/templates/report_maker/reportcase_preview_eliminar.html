        {% comment %}
        ──────────────────────────────────────────────────────────
        Conteúdo do laudo (outline)
        Contexto esperado:
          outline: lista de blocos (textos, headings, objetos e figuras) já enumerados pela view
        Este template é tolerante: se algum campo não existir, ele não quebra.
        ──────────────────────────────────────────────────────────
        {% endcomment %}

        {% if outline %}
          {% for it in outline %}

            {# ───────────── Títulos / seções ───────────── #}
            {% if it.kind == "heading" or it.kind == "title" %}
              <section class="report-section">
                <h2 class="section-heading">
                  {{ it.title|default:it.text|default:it.label|default:"" }}
                </h2>
              </section>

            {# ───────────── Texto simples ───────────── #}
            {% elif it.kind == "text" or it.kind == "paragraph" %}
              <section class="report-section">
                {% if it.html %}
                  {{ it.html|safe }}
                {% else %}
                  {{ it.text|default:""|linebreaks }}
                {% endif %}
              </section>

            {# ───────────── Bloco “objeto” (quando a outline carrega objetos) ───────────── #}
            {% elif it.kind == "object" %}
              <section class="report-section">
                <h3 class="section-heading">
                  {{ it.title|default:it.label|default:"" }}
                </h3>

                {% if it.body_html %}
                  {{ it.body_html|safe }}
                {% elif it.body %}
                  {{ it.body|linebreaks }}
                {% endif %}

                {% if it.images %}
                  <div class="row g-2 mt-2">
                    {% for img in it.images %}
                      <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                        <div class="card h-100 shadow-sm">
                          {% if img.url %}
                            <a href="{{ img.url }}" target="_blank" rel="noopener" class="text-decoration-none">
                              <img
                                src="{{ img.url }}"
                                class="card-img-top"
                                alt="{{ img.caption|default:'Imagem' }}"
                                style="height: 90px; object-fit: cover;"
                              />
                            </a>
                          {% endif %}
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                {% endif %}
              </section>

            {# ───────────── Figura (quando a outline já traz figuras) ───────────── #}
            {% elif it.kind == "figure" %}
              <section class="report-section">
                {% if it.url %}
                  <figure class="m-0">
                    <img
                      src="{{ it.url }}"
                      alt="{{ it.caption|default:'Figura' }}"
                      style="max-width: 100%; height: auto;"
                    />
                    {% if it.caption or it.figure_label %}
                      <figcaption class="small text-muted mt-1">
                        {{ it.figure_label|default:"Figura" }}{% if it.caption %} — {{ it.caption }}{% endif %}
                      </figcaption>
                    {% endif %}
                  </figure>
                {% endif %}
              </section>

            {# ───────────── Fallback seguro ───────────── #}
            {% else %}
              {% if it.html %}
                <section class="report-section">{{ it.html|safe }}</section>
              {% elif it.text %}
                <section class="report-section">{{ it.text|linebreaks }}</section>
              {% endif %}
            {% endif %}

          {% endfor %}
        {% else %}
          <p class="text-muted small mb-0">Nenhum conteúdo disponível para pré-visualização.</p>
        {% endif %}
