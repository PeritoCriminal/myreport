{# myreport/groups/templates/groups/partials/group_header.html #}
{% load static %}

<div class="position-relative mb-5">
  <div
    class="w-100 position-relative"
    style="
      height: 220px;
      background-image: url('{% if group.background_image %}{{ group.background_image.url }}{% else %}{% static 'img/backgroundimage.jpg' %}{% endif %}');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    "
  >
    <div class="position-absolute start-0 end-0" style="bottom: 0;">
      <div class="px-3 py-2" style="background: rgba(0,0,0,.35);">
        <div class="d-flex justify-content-end gap-2 flex-wrap">

          <a
            href="{% url 'groups:group_list' %}"
            class="btn btn-sm btn-light d-flex align-items-center gap-2 shadow-sm"
            title="Voltar"
          >
            <i class="bi bi-arrow-left"></i>
            <span class="d-none d-md-inline">Voltar</span>
          </a>

          {% if is_member %}
            <form method="post" action="{% url 'groups:group_leave' group.id %}">
              {% csrf_token %}
              <button class="btn btn-sm btn-outline-danger d-flex align-items-center gap-2 shadow-sm" type="submit">
                <i class="bi bi-box-arrow-right"></i>
                <span class="d-none d-md-inline">Sair</span>
              </button>
            </form>
          {% else %}
            <form method="post" action="{% url 'groups:group_join' group.id %}">
              {% csrf_token %}
              <button class="btn btn-sm btn-success d-flex align-items-center gap-2 shadow-sm" type="submit"
                      {% if not group.is_active %}disabled{% endif %}>
                <i class="bi bi-box-arrow-in-right"></i>
                <span class="d-none d-md-inline">Entrar</span>
              </button>
            </form>
          {% endif %}

        {# Ações do criador #}
        {% if is_creator and group.is_active %}

        {# Editar grupo #}
        <a
            href="{% url 'groups:group_update' group.id %}"
            class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2 shadow-sm"
            title="Editar grupo"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
        >
            <i class="bi bi-pencil-square"></i>
            <span class="d-none d-md-inline">Editar</span>
        </a>

        {# Inativar grupo #}
        <form method="post" action="{% url 'groups:group_deactivate' group.id %}">
            {% csrf_token %}
            <button
            class="btn btn-sm btn-outline-secondary d-flex align-items-center gap-2 shadow-sm"
            type="submit"
            title="Inativar grupo"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            >
            <i class="bi bi-slash-circle"></i>
            <span class="d-none d-md-inline">Inativar</span>
            </button>
        </form>

        {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="position-absolute start-0 ms-3" style="bottom: -56px;">
    <div class="d-flex align-items-center gap-3">
      {% if group.profile_image %}
        <img
          src="{{ group.profile_image.url }}"
          alt="Imagem do grupo"
          class="rounded-circle border border-4 border-white bg-white shadow-sm"
          style="width:112px; height:112px; object-fit:cover;"
        >
      {% else %}
        <div
          class="rounded-circle border border-4 border-white bg-white shadow-sm d-flex align-items-center justify-content-center"
          style="width:112px; height:112px;"
          aria-label="Grupo sem imagem"
        >
          <i class="bi bi-people fs-1 text-muted"></i>
        </div>
      {% endif %}

      <div class="pt-5 mt-5 d-none d-md-block">
        <h4 class="fw-bold m-0 text-truncate">{{ group.name }}</h4>
      </div>
    </div>
  </div>
</div>
